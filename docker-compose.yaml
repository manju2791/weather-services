version: '3'

services:
  weather:
    image: weather
    build:
      context: ./services/weather
    expose:
      - 50051
    depends_on:
      - redis
    env_file: 
      - ./services/weather/environments/.env.development
    # restart: on-failure
    
  gateway:
    image: gateway
    build:
      context: ./services/gateway
    ports:
      - 8080:8080
    depends_on: 
      - weather
      - redis
    env_file: 
      - ./services/gateway/environments/.env.development
    # restart: on-failure

  redis:
    image: bitnami/redis:latest
    container_name: redis_container
    environment: 
      - ALLOW_EMPTY_PASSWORD=yes
      - REDIS_DISABLE_COMMANDS=FLUSHDB,FLUSHALL
    labels:
      kompose.service.type: nodeport
    volumes:
      - redis_data:/bitnami/redis
    ports:
      - 6379:6379

volumes: 
  redis_data:

    

